WEBVTT
Kind: captions
Language: en

00:00:00.000 --> 00:00:02.405
[LAUGHTER]

00:00:04.329 --> 00:00:06.734
[MUSIC PLAYING]

00:00:12.510 --> 00:00:13.210
SURMA: So--

00:00:13.210 --> 00:00:13.710
JAKE: So.

00:00:13.710 --> 00:00:14.650
SURMA: It's been a while.

00:00:14.650 --> 00:00:15.430
JAKE: It has been a while.

00:00:15.430 --> 00:00:15.979
SURMA: It's-- ah!

00:00:15.979 --> 00:00:17.170
It's good to-- good to back.

00:00:17.170 --> 00:00:17.670
JAKE: Is it?

00:00:17.670 --> 00:00:18.202
SURMA: Eh.

00:00:18.202 --> 00:00:19.020
JAKE: Well, let me be the--

00:00:19.020 --> 00:00:19.800
I'll be the judge of that.

00:00:19.800 --> 00:00:20.430
SURMA: OK.

00:00:20.430 --> 00:00:23.490
Well, I thought we
would start by talking

00:00:23.490 --> 00:00:24.950
about-- we've built two apps.

00:00:24.950 --> 00:00:25.870
That's basically
where I'm coming from.

00:00:25.870 --> 00:00:26.870
We have built two apps--

00:00:26.870 --> 00:00:27.870
JAKE: --in our lifetime.

00:00:27.870 --> 00:00:28.650
SURMA: --in-- yes.

00:00:28.650 --> 00:00:28.950
JAKE: Yeah.

00:00:28.950 --> 00:00:30.600
SURMA: Nothing every else
we built then, except this.

00:00:30.600 --> 00:00:32.549
No, in this team that we
have established here--

00:00:32.549 --> 00:00:33.507
JAKE: Little team, yep.

00:00:33.507 --> 00:00:34.600
SURMA: --we built Squoosh.

00:00:34.600 --> 00:00:35.100
JAKE: Yes.

00:00:35.100 --> 00:00:37.155
SURMA: We have talked about
that about a million times.

00:00:37.155 --> 00:00:37.410
JAKE: Mm-hmm.

00:00:37.410 --> 00:00:38.200
SURMA: One, two, or three?

00:00:38.200 --> 00:00:38.742
JAKE: Mm-hmm.

00:00:38.742 --> 00:00:40.840
SURMA: And we
recently built PROXX--

00:00:40.840 --> 00:00:41.340
JAKE: Yes.

00:00:41.340 --> 00:00:44.610
SURMA: --our little Minesweeper
clone, reimagined on the web,

00:00:44.610 --> 00:00:45.690
modern visuals--

00:00:45.690 --> 00:00:46.360
all that.

00:00:46.360 --> 00:00:46.860
JAKE: Yep.

00:00:46.860 --> 00:00:49.290
SURMA: And it turns out that
when you build a real app,

00:00:49.290 --> 00:00:54.520
you sometimes have to make
some workarounds happen--

00:00:54.520 --> 00:00:57.970
about the problems that
happen in the odd browser that

00:00:57.970 --> 00:00:58.793
doesn't quite fit--

00:00:58.793 --> 00:00:59.710
JAKE: The odd browser?

00:00:59.710 --> 00:00:59.890
SURMA: Yes.

00:00:59.890 --> 00:01:01.600
JAKE: Are you talking about
specifically one browser?

00:01:01.600 --> 00:01:02.410
SURMA: [LAUGHS]

00:01:02.410 --> 00:01:04.840
JAKE: All the browsers are
fine except the odd browser.

00:01:04.840 --> 00:01:05.420
[LAUGHTER]

00:01:05.420 --> 00:01:06.870
SURMA: That would be a
great name for a browser.

00:01:06.870 --> 00:01:07.740
JAKE: Yep. we'll
release the Odd Browser.

00:01:07.740 --> 00:01:09.433
SURMA: Browse safer
with Odd Browser.

00:01:09.433 --> 00:01:11.100
JAKE: Or maybe it's
odd version numbers.

00:01:11.100 --> 00:01:12.490
It's like the "Star Trek" films.

00:01:12.490 --> 00:01:14.280
The odd version numbers
are the bad ones.

00:01:14.280 --> 00:01:14.780
SURMA: Yeah.

00:01:14.780 --> 00:01:15.256
JAKE: And the even
ones are fine.

00:01:15.256 --> 00:01:16.210
SURMA: It would make
a lot sense of how

00:01:16.210 --> 00:01:17.110
Chrome behaves sometimes.

00:01:17.110 --> 00:01:17.310
JAKE: Yeah.

00:01:17.310 --> 00:01:17.893
Yes, it would.

00:01:17.893 --> 00:01:18.850
[LAUGHTER]

00:01:18.850 --> 00:01:21.830
SURMA: So I thought I
would go through our code.

00:01:21.830 --> 00:01:22.330
JAKE: OK.

00:01:22.330 --> 00:01:23.275
Ah, interesting.

00:01:23.275 --> 00:01:27.140
SURMA: And figure out the top
four stupidest hacks that--

00:01:27.140 --> 00:01:29.575
JAKE: Oh, so this these are
all going to be from PROXX?

00:01:29.575 --> 00:01:29.900
Or--

00:01:29.900 --> 00:01:30.940
SURMA: PROXX and Squoosh.

00:01:30.940 --> 00:01:31.590
JAKE: PROXX and Squoosh.

00:01:31.590 --> 00:01:31.750
SURMA: Yes.

00:01:31.750 --> 00:01:32.417
JAKE: All right.

00:01:32.417 --> 00:01:35.205
That does sound like a terrible
kid's TV show, doesn't it?

00:01:35.205 --> 00:01:35.705
[LAUGHS]

00:01:35.705 --> 00:01:36.510
SURMA: PROXX and Squoosh.

00:01:36.510 --> 00:01:38.260
JAKE: Welcome to PROXX and
Squoosh. (HIGH VOICE) Yay!

00:01:38.260 --> 00:01:39.520
(SINGING) Bop-de-bop,
da-da-da, bop-de-bop.

00:01:39.520 --> 00:01:40.750
SURMA: That's pretty
much how I felt

00:01:40.750 --> 00:01:41.830
looking at the code samples.

00:01:41.830 --> 00:01:42.190
JAKE: Excellent.

00:01:42.190 --> 00:01:42.690
OK.

00:01:42.690 --> 00:01:46.750
SURMA: So yeah, let's start
with the first thing, which

00:01:46.750 --> 00:01:48.390
is about the Canvas OOM.

00:01:48.390 --> 00:01:49.150
JAKE: OOM.

00:01:49.150 --> 00:01:49.822
SURMA: And--

00:01:49.822 --> 00:01:50.322
JAKE: Um--

00:01:50.322 --> 00:01:50.900
SURMA: Um--

00:01:50.900 --> 00:01:51.400
JAKE: Right?

00:01:51.400 --> 00:01:53.365
SURMA: You remember this,
because you fixed it.

00:01:53.365 --> 00:01:53.865
JAKE: Right.

00:01:53.865 --> 00:01:55.948
SURMA: But I'm still going
to explain what it was.

00:01:55.948 --> 00:02:01.000
So in PROXX, we render
our game field-- the grid

00:02:01.000 --> 00:02:02.350
where the tiles are.

00:02:02.350 --> 00:02:04.630
Some might be mines, or
black holes, in our case.

00:02:04.630 --> 00:02:05.130
JAKE: Yep.

00:02:05.130 --> 00:02:06.820
SURMA: Or not black holes.

00:02:06.820 --> 00:02:08.470
And we have animations running.

00:02:08.470 --> 00:02:10.970
And so we thought to make
it as fast as possible,

00:02:10.970 --> 00:02:13.720
we will be using
sprites that have

00:02:13.720 --> 00:02:15.400
every frame of an animation.

00:02:15.400 --> 00:02:16.365
They look like this.

00:02:16.365 --> 00:02:16.865
JAKE: Right.

00:02:16.865 --> 00:02:17.130
SURMA: And this--

00:02:17.130 --> 00:02:18.180
JAKE: Oh, so this is the--

00:02:18.180 --> 00:02:20.020
OK, so this is every
frame of the animation.

00:02:20.020 --> 00:02:20.500
SURMA: Well, it's not--

00:02:20.500 --> 00:02:22.420
JAKE: We draw a rectangle
over the top of it, right?

00:02:22.420 --> 00:02:23.260
For the outer bounds.

00:02:23.260 --> 00:02:23.450
SURMA: Right.

00:02:23.450 --> 00:02:25.660
So we crop out one of
the things that we need

00:02:25.660 --> 00:02:27.040
and put that on the tile.

00:02:27.040 --> 00:02:28.570
And so in the next
frame, we just

00:02:28.570 --> 00:02:30.850
crop out the next square
from this sprite sheet

00:02:30.850 --> 00:02:32.140
and put that on screen.

00:02:32.140 --> 00:02:34.950
And if that happens every frame,
it looks like an animation.

00:02:34.950 --> 00:02:35.450
JAKE: Right.

00:02:35.450 --> 00:02:37.117
SURMA: And that means
you don't actually

00:02:37.117 --> 00:02:39.670
have to have-- this is
four or five squares that

00:02:39.670 --> 00:02:40.550
rotate independently.

00:02:40.550 --> 00:02:41.160
JAKE: Yep.

00:02:41.160 --> 00:02:42.800
SURMA: We could
do it with a DOM.

00:02:42.800 --> 00:02:44.800
That would be a lot of
DOM, and a lot of layers,

00:02:44.800 --> 00:02:45.980
and it would not be fast.

00:02:45.980 --> 00:02:46.480
JAKE: Yes.

00:02:46.480 --> 00:02:48.250
SURMA: So in this case,
we're just copying

00:02:48.250 --> 00:02:49.460
pixels, which is really fast.

00:02:49.460 --> 00:02:49.960
JAKE: Right.

00:02:49.960 --> 00:02:52.168
So for every frame, we were
just taking part of that.

00:02:52.168 --> 00:02:53.030
Is just all of them?

00:02:53.030 --> 00:02:53.530
SURMA: No.

00:02:53.530 --> 00:02:55.930
This is a quarter or
half of the frames.

00:02:55.930 --> 00:02:57.720
JAKE: A quarter or half of them.

00:02:57.720 --> 00:02:59.860
And so yes, it's every
frame, 60 times a second.

00:02:59.860 --> 00:03:03.285
We were essentially
taking a different section

00:03:03.285 --> 00:03:03.910
of this sprite.

00:03:03.910 --> 00:03:04.570
SURMA: Yeah, and put it
on screen for one tile.

00:03:04.570 --> 00:03:04.850
JAKE: Right.

00:03:04.850 --> 00:03:05.100
OK, OK.

00:03:05.100 --> 00:03:05.250
Yes, yes, yes.

00:03:05.250 --> 00:03:08.080
SURMA: And that would happen
for each tile of the game field.

00:03:08.080 --> 00:03:10.150
So that you can see if
that was actual DOM,

00:03:10.150 --> 00:03:11.317
that would be too expensive.

00:03:11.317 --> 00:03:12.580
So we used sprites, and--

00:03:12.580 --> 00:03:15.130
JAKE: How many-- on screen at
a time, we would have, like,

00:03:15.130 --> 00:03:16.255
500 of these going at once.

00:03:16.255 --> 00:03:17.672
SURMA: Potentially,
or a bit more.

00:03:17.672 --> 00:03:19.420
JAKE: And doing
that in the DOM--

00:03:19.420 --> 00:03:20.170
SURMA: No.

00:03:20.170 --> 00:03:20.740
Just--

00:03:20.740 --> 00:03:21.040
JAKE: Too slow.

00:03:21.040 --> 00:03:22.210
SURMA: It's not what
it was built for.

00:03:22.210 --> 00:03:22.360
It's [INAUDIBLE].

00:03:22.360 --> 00:03:23.140
JAKE: Right.

00:03:23.140 --> 00:03:25.420
SURMA: Yes.

00:03:25.420 --> 00:03:27.550
And because we didn't
know the device

00:03:27.550 --> 00:03:29.148
that you are running on--

00:03:29.148 --> 00:03:30.190
the web can run anywhere.

00:03:30.190 --> 00:03:33.040
It can be a low-end feature
phone with, like, 320

00:03:33.040 --> 00:03:34.090
by 240 pixels.

00:03:34.090 --> 00:03:36.658
It can be my iMac 5K monitor.

00:03:36.658 --> 00:03:37.450
JAKE: Oh, show off.

00:03:37.450 --> 00:03:38.586
Just 'cause you've got
an iMac 5K monitor.

00:03:38.586 --> 00:03:39.520
SURMA: Yes, I do.

00:03:39.520 --> 00:03:40.520
I do.

00:03:40.520 --> 00:03:41.822
JAKE: I've got my--

00:03:41.822 --> 00:03:43.030
I know what this sounds like.

00:03:43.030 --> 00:03:47.050
It's terrible complaining that
I have my poor 32-inch monitor

00:03:47.050 --> 00:03:47.570
at work.

00:03:47.570 --> 00:03:49.710
But it's only, like,
one DPI, and you

00:03:49.710 --> 00:03:53.223
rocking with your massive, 4K--

00:03:53.223 --> 00:03:53.890
it's more like--

00:03:53.890 --> 00:03:54.580
SURMA: Like 5K?

00:03:54.580 --> 00:03:57.640
JAKE: 4-- 5K screen, yes.

00:03:57.640 --> 00:03:58.720
I'm on my 1K.

00:03:58.720 --> 00:04:00.830
Anyway, I'm jealous,
but carry on.

00:04:00.830 --> 00:04:01.330
SURMA: Yes.

00:04:01.330 --> 00:04:02.230
It's great.

00:04:02.230 --> 00:04:03.155
JAKE: Thanks.

00:04:03.155 --> 00:04:05.530
SURMA: But basically, we could
either generate one sprite

00:04:05.530 --> 00:04:08.290
sheet and just have everyone
down on the same sprite sheet,

00:04:08.290 --> 00:04:09.357
which will be rather big.

00:04:09.357 --> 00:04:10.690
And we thought, that's not good.

00:04:10.690 --> 00:04:14.110
So rather, we used Canvas
to generate the sprite sheet

00:04:14.110 --> 00:04:17.110
on the client side, when you
load the exact resolution

00:04:17.110 --> 00:04:18.220
that this device needs.

00:04:18.220 --> 00:04:18.720
JAKE: Yeah.

00:04:18.720 --> 00:04:22.250
So we use Canvas
2D to draw these.

00:04:22.250 --> 00:04:22.750
SURMA: Yes.

00:04:22.750 --> 00:04:26.148
JAKE: But we use Canvas WebGL
to put them on the screen.

00:04:26.148 --> 00:04:26.690
SURMA: Right.

00:04:26.690 --> 00:04:27.670
JAKE: Am I crimping
your content?

00:04:27.670 --> 00:04:28.080
SURMA: No.

00:04:28.080 --> 00:04:28.380
That's good.

00:04:28.380 --> 00:04:28.820
JAKE: Oh, OK.

00:04:28.820 --> 00:04:29.370
SURMA: That's exactly
what's happening.

00:04:29.370 --> 00:04:29.870
JAKE: Good.

00:04:29.870 --> 00:04:33.520
SURMA: So we're using Canvas and
just drawing these rectangles,

00:04:33.520 --> 00:04:36.150
because that is actually what
Canvas 2D is really fast at.

00:04:36.150 --> 00:04:36.650
JAKE: Yep.

00:04:36.650 --> 00:04:39.790
SURMA: And we know we can figure
out what the resolution is

00:04:39.790 --> 00:04:41.750
and what the pixel density is.

00:04:41.750 --> 00:04:46.360
And so what we have is basically
a function, "generate sprite."

00:04:46.360 --> 00:04:46.910
JAKE: Right.

00:04:46.910 --> 00:04:47.410
Yes.

00:04:47.410 --> 00:04:49.810
SURMA: And so we created
Canvas 2D, get the context.

00:04:49.810 --> 00:04:52.330
We scale the canvas to match
the device pixel ratio,

00:04:52.330 --> 00:04:54.580
because if it's a 3X
screen, it should look--

00:04:54.580 --> 00:04:55.840
JAKE: Like a 5K monitor.

00:04:55.840 --> 00:04:56.110
SURMA: Exactly.

00:04:56.110 --> 00:04:56.380
Pixelated.

00:04:56.380 --> 00:04:56.982
JAKE: OK.

00:04:56.982 --> 00:04:58.690
SURMA: And then we
just go through a loop

00:04:58.690 --> 00:05:00.820
with all the frames.

00:05:00.820 --> 00:05:03.850
We move our canvas
to a position where

00:05:03.850 --> 00:05:05.920
this new frame is to 0, 0.

00:05:05.920 --> 00:05:07.550
And then call this
draw frame function,

00:05:07.550 --> 00:05:09.363
which just draws a
frame of the animation.

00:05:09.363 --> 00:05:10.780
So we have a
function that draws--

00:05:10.780 --> 00:05:13.820
is capable of drawing every
frame, always at 0, 0.

00:05:13.820 --> 00:05:14.320
JAKE: Right.

00:05:14.320 --> 00:05:15.987
SURMA: And then we
have this big canvas,

00:05:15.987 --> 00:05:18.393
and we move it to draw on it.

00:05:18.393 --> 00:05:19.060
JAKE: Excellent.

00:05:19.060 --> 00:05:21.460
SURMA: And then, now we
have a canvas that contains

00:05:21.460 --> 00:05:22.460
the entire sprite sheet.

00:05:22.460 --> 00:05:24.918
And we have multiple animations,
so we have multiple sprite

00:05:24.918 --> 00:05:25.420
sheets.

00:05:25.420 --> 00:05:29.650
And so this is what we did, and
it worked great on all phones,

00:05:29.650 --> 00:05:30.520
except--

00:05:30.520 --> 00:05:31.490
JAKE: The odd browser.

00:05:31.490 --> 00:05:32.230
SURMA: The odd browser.

00:05:32.230 --> 00:05:33.313
JAKE: Which in this case--

00:05:33.313 --> 00:05:34.990
SURMA: In this case,
it was iOS Safari.

00:05:34.990 --> 00:05:35.612
JAKE: It was.

00:05:35.612 --> 00:05:37.820
SURMA: Which for some reason,
decided, you know what?

00:05:37.820 --> 00:05:39.370
You're creating
too many canvases.

00:05:39.370 --> 00:05:41.197
I'm going to kill your page.

00:05:41.197 --> 00:05:43.030
JAKE: It took us quite
a while to figure out

00:05:43.030 --> 00:05:43.730
that that's what was going.

00:05:43.730 --> 00:05:44.230
SURMA: Yeah.

00:05:44.230 --> 00:05:46.680
JAKE: Like, all we
saw was a full crash.

00:05:46.680 --> 00:05:48.400
SURMA: Literally
saying, this page

00:05:48.400 --> 00:05:50.373
has been reloaded
due to a problem.

00:05:50.373 --> 00:05:52.040
And it would do that
four or five times,

00:05:52.040 --> 00:05:53.123
and then it would give up.

00:05:53.123 --> 00:05:53.640
JAKE: Yes.

00:05:53.640 --> 00:05:54.420
SURMA: Not a great experience.

00:05:54.420 --> 00:05:55.320
JAKE: Not a great experience.

00:05:55.320 --> 00:05:57.362
SURMA: But eventually, we
figured out that, well,

00:05:57.362 --> 00:06:00.180
so far we have to do this-- it
is probably a memory pressure

00:06:00.180 --> 00:06:03.180
thing that we were-- because
all these canvases are backed

00:06:03.180 --> 00:06:07.620
by a frame bot, or the chunk of
memory represents the pixels.

00:06:07.620 --> 00:06:09.705
And having too many of
those, apparently, Safari

00:06:09.705 --> 00:06:10.920
is like, you know what?

00:06:10.920 --> 00:06:12.723
This is over my threshold.

00:06:12.723 --> 00:06:13.890
I'm going to kill this page.

00:06:13.890 --> 00:06:19.280
JAKE: If you get a tab in a
browser that just crashes out,

00:06:19.280 --> 00:06:21.560
I would say, more than
50% of time, it's memory.

00:06:21.560 --> 00:06:21.720
SURMA: Yeah.

00:06:21.720 --> 00:06:22.220
JAKE: Right?

00:06:22.220 --> 00:06:24.220
You've either found a
bug in the browser that

00:06:24.220 --> 00:06:26.070
has caused it to crash
out, but the time

00:06:26.070 --> 00:06:28.560
that a browser will
willfully crash out

00:06:28.560 --> 00:06:30.060
is when you've
run out of memory.

00:06:30.060 --> 00:06:31.060
SURMA: Something-- yeah.

00:06:31.060 --> 00:06:32.190
JAKE: It's like, I
need that memory back,

00:06:32.190 --> 00:06:33.898
else the whole system
is going to-- yeah.

00:06:33.898 --> 00:06:36.250
SURMA: So the thing that we
thought, how do we fix it,

00:06:36.250 --> 00:06:38.790
we-- or I guess,
you were like, well,

00:06:38.790 --> 00:06:42.840
but I can load images that
have the same dimensions

00:06:42.840 --> 00:06:43.430
as our canvas.

00:06:43.430 --> 00:06:46.830
So our sprite sheet was like
2,000 by 2,000 pixels, I think.

00:06:46.830 --> 00:06:47.330
JAKE: Yeah.

00:06:47.330 --> 00:06:49.455
SURMA: We can load an image
on a website like that.

00:06:49.455 --> 00:06:50.970
Why is the canvas
suddenly too much?

00:06:50.970 --> 00:06:52.845
JAKE: You can load loads
of images like that.

00:06:52.845 --> 00:06:55.150
SURMA: And so here
is our great fix.

00:06:55.150 --> 00:06:55.650
JAKE: Right.

00:06:55.650 --> 00:06:59.430
SURMA: And for having a sprite,
we generate that sprite.

00:06:59.430 --> 00:07:01.452
We turn it into a blob.

00:07:01.452 --> 00:07:02.160
JAKE: Yes, we do.

00:07:02.160 --> 00:07:04.440
SURMA: We turn that
blob into an image.

00:07:04.440 --> 00:07:05.490
JAKE: Yes, we did.

00:07:05.490 --> 00:07:06.350
SURMA: And we keep that image.

00:07:06.350 --> 00:07:07.725
JAKE: And then we
keep the image.

00:07:07.725 --> 00:07:10.253
SURMA: And so we only ever
have one canvas at a time.

00:07:10.253 --> 00:07:11.020
JAKE: Yeah.

00:07:11.020 --> 00:07:12.842
SURMA: And so
Safari is now fine.

00:07:12.842 --> 00:07:15.300
JAKE: And to do this-- oh, it's
really annoying, because we

00:07:15.300 --> 00:07:16.780
are having to encode as PNG.

00:07:16.780 --> 00:07:18.030
SURMA: Yep, just to decode it.

00:07:18.030 --> 00:07:19.488
JAKE: So then we
can decode as PN--

00:07:19.488 --> 00:07:20.323
SURMA: [LAUGHS]

00:07:20.323 --> 00:07:21.615
JAKE: And now-- but now, it's--

00:07:21.615 --> 00:07:23.250
SURMA: Which surely must
be more memory pressure.

00:07:23.250 --> 00:07:24.875
They're just keeping
the canvas around.

00:07:24.875 --> 00:07:27.882
JAKE: Yes, but presumably
the Safari on iOS

00:07:27.882 --> 00:07:30.090
must be smarter with images
than it is with canvases.

00:07:30.090 --> 00:07:30.632
SURMA: Maybe.

00:07:30.632 --> 00:07:32.610
JAKE: Like the image
it can put down

00:07:32.610 --> 00:07:36.690
onto disk, rather with memory
or something like that, and--

00:07:36.690 --> 00:07:37.710
SURMA: It fixed it.

00:07:37.710 --> 00:07:38.877
It now works perfectly fine.

00:07:38.877 --> 00:07:41.940
JAKE: Oh, it was so annoying And
it was purely just by finding

00:07:41.940 --> 00:07:43.122
something that we knew--

00:07:43.122 --> 00:07:45.330
something that was similar
that the browser could do.

00:07:45.330 --> 00:07:47.715
You can still write
images to a canvas.

00:07:47.715 --> 00:07:49.590
You can write canvases
or images to canvases,

00:07:49.590 --> 00:07:52.530
but canvases, it crashed.

00:07:52.530 --> 00:07:54.090
Images, it didn't.

00:07:54.090 --> 00:07:54.760
SURMA: OK.

00:07:54.760 --> 00:07:55.260
JAKE: Fine.

00:07:55.260 --> 00:07:56.286
SURMA: Told you, this is
going to be stupid hacks.

00:07:56.286 --> 00:07:57.030
JAKE: Carry on.

00:07:57.030 --> 00:07:57.300
Yes.

00:07:57.300 --> 00:07:57.840
OK.

00:07:57.840 --> 00:07:58.350
SURMA: So the next one is--

00:07:58.350 --> 00:07:59.340
JAKE: Worker Murder.

00:07:59.340 --> 00:08:00.630
SURMA: --is the Worker Murder.

00:08:00.630 --> 00:08:03.027
Because sometimes, workers
are allowed to die.

00:08:03.027 --> 00:08:03.610
JAKE: [LAUGHS]

00:08:03.610 --> 00:08:04.830
SURMA: Sometimes, they are not.

00:08:04.830 --> 00:08:05.260
JAKE: OK.

00:08:05.260 --> 00:08:06.450
SURMA: And it still happens.

00:08:06.450 --> 00:08:11.337
So we-- both Squoosh and
PROXX have off-main thread

00:08:11.337 --> 00:08:12.170
architecture going--

00:08:12.170 --> 00:08:12.330
JAKE: Yes, they do.

00:08:12.330 --> 00:08:14.030
SURMA: Like, they do
work off main thread.

00:08:14.030 --> 00:08:14.580
JAKE: Yes.

00:08:14.580 --> 00:08:16.747
SURMA: We didn't run into
this problem with Squoosh,

00:08:16.747 --> 00:08:19.140
and we will figure out
why throughout this.

00:08:19.140 --> 00:08:20.400
JAKE: Oh.

00:08:20.400 --> 00:08:23.910
SURMA: So what we do is
usually, server worker,

00:08:23.910 --> 00:08:27.120
and we often use Comlink
to make the interaction

00:08:27.120 --> 00:08:28.920
with the worker really nice.

00:08:28.920 --> 00:08:31.470
But for some reason,
when we did this,

00:08:31.470 --> 00:08:33.220
our app would stop working.

00:08:33.220 --> 00:08:35.190
Just not react anymore.

00:08:35.190 --> 00:08:36.674
JAKE: In the odd browser.

00:08:36.674 --> 00:08:37.799
SURMA: In the odd browser--

00:08:37.799 --> 00:08:38.370
in iOS Safari.

00:08:38.370 --> 00:08:39.495
JAKE: Which was iOS Safari.

00:08:39.495 --> 00:08:44.513
And we should say, many
browsers have bugs, right?

00:08:44.513 --> 00:08:46.680
It just so happened that
we encountered most of them

00:08:46.680 --> 00:08:47.160
on iOS Safari.

00:08:47.160 --> 00:08:47.670
SURMA: Yeah.

00:08:47.670 --> 00:08:48.837
JAKE: Not on Safari desktop.

00:08:48.837 --> 00:08:50.908
SURMA: Also-- No,
only iOS Safari.

00:08:50.908 --> 00:08:51.825
JAKE: Only iOS Safari.

00:08:51.825 --> 00:08:52.325
Right.

00:08:52.325 --> 00:08:53.440
SURMA: Also-- yeah.

00:08:53.440 --> 00:08:55.690
The reason I picked these
is because the solutions are

00:08:55.690 --> 00:08:56.780
so stupid.

00:08:56.780 --> 00:08:57.500
Like-- right?

00:08:57.500 --> 00:08:57.750
JAKE: Yes.

00:08:57.750 --> 00:08:59.280
SURMA: We have bugs
in other browsers,

00:08:59.280 --> 00:09:01.430
but their solution is like,
oh, they don't support blah.

00:09:01.430 --> 00:09:02.250
Just do dash [INAUDIBLE].

00:09:02.250 --> 00:09:02.850
JAKE: Put an if around it.

00:09:02.850 --> 00:09:03.767
SURMA: --or something.

00:09:03.767 --> 00:09:06.960
But here, we actually had
to be creative and come up

00:09:06.960 --> 00:09:08.220
with very weird solutions.

00:09:08.220 --> 00:09:08.730
JAKE: Yes.

00:09:08.730 --> 00:09:10.397
SURMA: So basically,
what we figured out

00:09:10.397 --> 00:09:12.400
is that the worker got killed.

00:09:12.400 --> 00:09:13.985
JAKE: Just got
killed, didn't it?

00:09:13.985 --> 00:09:16.360
SURMA: Even though it still
existed and had things to do,

00:09:16.360 --> 00:09:18.130
it was basically
waiting for a message.

00:09:18.130 --> 00:09:21.160
And then it's spec compliant
to wait for a message.

00:09:21.160 --> 00:09:22.600
But iOS was like, you know what?

00:09:22.600 --> 00:09:23.990
The workers are expensive.

00:09:23.990 --> 00:09:25.050
We want that memory back.

00:09:25.050 --> 00:09:25.870
And [POPS LIPS]

00:09:25.870 --> 00:09:28.930
JAKE: So then, we were kind
of like, well, what is this--

00:09:28.930 --> 00:09:30.610
well, we wanted to
confirm our theory.

00:09:30.610 --> 00:09:31.110
SURMA: Yeah.

00:09:31.110 --> 00:09:32.660
JAKE: Is this
worker being killed?

00:09:32.660 --> 00:09:37.100
And so what if it was like,
well, let's do things like,

00:09:37.100 --> 00:09:38.450
we'll ping the worker.

00:09:38.450 --> 00:09:40.180
So we can see those
messages coming back.

00:09:40.180 --> 00:09:40.790
Here it is.

00:09:40.790 --> 00:09:41.860
[LAUGHTER]

00:09:41.860 --> 00:09:42.443
I see.

00:09:42.443 --> 00:09:43.360
SURMA: So we did that.

00:09:43.360 --> 00:09:43.860
JAKE: Yes.

00:09:43.860 --> 00:09:45.130
SURMA: And it made it better.

00:09:45.130 --> 00:09:45.940
JAKE: It made it better.

00:09:45.940 --> 00:09:47.540
SURMA: But it didn't
quite solve it.

00:09:47.540 --> 00:09:48.998
So basically,
sending a message was

00:09:48.998 --> 00:09:51.880
like, oh, it seems to
be around now, but then

00:09:51.880 --> 00:09:54.020
on a more constrained
iOS device,

00:09:54.020 --> 00:09:55.240
it would still get killed.

00:09:55.240 --> 00:09:57.760
And then we're
like, you know what?

00:09:57.760 --> 00:09:59.740
We're just going to send
a message every three

00:09:59.740 --> 00:10:00.370
seconds, because you know--

00:10:00.370 --> 00:10:01.217
JAKE: Yes, we did.

00:10:01.217 --> 00:10:02.050
SURMA: --and we did.

00:10:02.050 --> 00:10:04.237
And that made it even
better, but we still

00:10:04.237 --> 00:10:05.320
found corner cases where--

00:10:05.320 --> 00:10:07.340
JAKE: Well, we settled on
this fix for a long time.

00:10:07.340 --> 00:10:07.870
SURMA: Yeah.

00:10:07.870 --> 00:10:09.460
JAKE: This was
our fix, because--

00:10:09.460 --> 00:10:13.300
and it was really just as
we were trying to debug it--

00:10:13.300 --> 00:10:16.200
this trying to debug it
made it kind of work again.

00:10:16.200 --> 00:10:17.373
And we thought, ah.

00:10:17.373 --> 00:10:18.040
No one touch it.

00:10:18.040 --> 00:10:19.070
[LAUGHTER]

00:10:19.070 --> 00:10:19.570
Walk--

00:10:19.570 --> 00:10:19.800
SURMA: This is OK.

00:10:19.800 --> 00:10:20.758
JAKE: Walk away slowly.

00:10:20.758 --> 00:10:21.607
SURMA: [LAUGHS]

00:10:21.607 --> 00:10:22.690
JAKE: That's our solution.

00:10:22.690 --> 00:10:23.230
Fine.

00:10:23.230 --> 00:10:25.960
SURMA: And then we still,
eventually found some corner

00:10:25.960 --> 00:10:28.085
cases where it would not work.

00:10:28.085 --> 00:10:29.460
The worker would
still disappear.

00:10:29.460 --> 00:10:30.100
JAKE: Yep.

00:10:30.100 --> 00:10:31.142
SURMA: And--

00:10:31.142 --> 00:10:33.100
JAKE: Well, our theory
was it was disappearing.

00:10:33.100 --> 00:10:34.420
We could never fully confirm it.

00:10:34.420 --> 00:10:34.690
SURMA: No.

00:10:34.690 --> 00:10:35.410
It-- yeah.

00:10:35.410 --> 00:10:39.520
Because the initial problem
is that the simulator--

00:10:39.520 --> 00:10:43.665
the iOS simulator is very
slow, and it's actually

00:10:43.665 --> 00:10:45.790
behaving differently from
an actual device in terms

00:10:45.790 --> 00:10:46.990
of how iOS Safari behaves.

00:10:46.990 --> 00:10:47.200
JAKE: Yes.

00:10:47.200 --> 00:10:48.100
SURMA: And on
earlier devices, we

00:10:48.100 --> 00:10:50.080
didn't have proper
[INAUDIBLE] forwarding,

00:10:50.080 --> 00:10:51.497
and so we always
had to deploy it.

00:10:51.497 --> 00:10:54.130
And that slowed down the
entire debugging process.

00:10:54.130 --> 00:10:56.390
It was cumbersome,
to say the least.

00:10:56.390 --> 00:10:57.790
JAKE: It always--
debugging this,

00:10:57.790 --> 00:11:00.040
every time we saw
the bug again it

00:11:00.040 --> 00:11:02.912
felt like, during the
process of debugging it,

00:11:02.912 --> 00:11:04.120
it would start working again.

00:11:04.120 --> 00:11:04.180
SURMA: Yeah.

00:11:04.180 --> 00:11:05.430
JAKE: And we'd be like, right.

00:11:05.430 --> 00:11:06.800
Let's just-- let's move away.

00:11:06.800 --> 00:11:08.650
And then it would fall over
again when we weren't looking.

00:11:08.650 --> 00:11:10.442
SURMA: And then we
actually found something

00:11:10.442 --> 00:11:11.603
that seemed to resolve it.

00:11:11.603 --> 00:11:13.020
We still think it
has resolved it,

00:11:13.020 --> 00:11:15.320
and it's so stupid
that I kind of love it.

00:11:15.320 --> 00:11:17.410
Instead of pinging it
every three seconds--

00:11:17.410 --> 00:11:18.820
JAKE: [HUMMING FANFARE]

00:11:18.820 --> 00:11:20.320
SURMA: We just put
it on the global.

00:11:20.320 --> 00:11:21.940
JAKE: Yeah, we did.

00:11:21.940 --> 00:11:25.008
And again, this was
me trying to debug it.

00:11:25.008 --> 00:11:27.050
And I thought, well, if
I can put it on a global,

00:11:27.050 --> 00:11:28.420
then I can just
debug the console.

00:11:28.420 --> 00:11:29.425
SURMA: You can de-console it.

00:11:29.425 --> 00:11:29.800
JAKE: And--

00:11:29.800 --> 00:11:30.940
SURMA: But then it disappeared.

00:11:30.940 --> 00:11:32.200
JAKE: And then I was
like, I couldn't--

00:11:32.200 --> 00:11:33.000
I was so angry.

00:11:33.000 --> 00:11:34.510
It was like, I can't
recreate the problem.

00:11:34.510 --> 00:11:35.677
And it wasn't till, hang on.

00:11:35.677 --> 00:11:37.660
Let me just remove
that one line I added.

00:11:37.660 --> 00:11:38.500
Bug comes back.

00:11:38.500 --> 00:11:41.320
SURMA: To be fair, we did try
to make some reduced test cases,

00:11:41.320 --> 00:11:42.290
and it never happened.

00:11:42.290 --> 00:11:44.697
So our theory is,
because Comlink uses--

00:11:44.697 --> 00:11:45.280
JAKE: Proxies.

00:11:45.280 --> 00:11:46.090
SURMA: --proxies.

00:11:46.090 --> 00:11:48.880
That the combination of
sending workers when something

00:11:48.880 --> 00:11:52.360
is done by a proxy, that there's
something about that garbage

00:11:52.360 --> 00:11:55.330
collection marking
algorithm that might just

00:11:55.330 --> 00:11:57.820
be a weird corner case bug,
which is why the workers get

00:11:57.820 --> 00:11:59.420
collected when you use Comlink.

00:11:59.420 --> 00:11:59.920
JAKE: Yeah.

00:11:59.920 --> 00:12:02.162
It thinks, because it's
going through a proxy,

00:12:02.162 --> 00:12:04.370
it's not counting that as
a reference when it should.

00:12:04.370 --> 00:12:04.690
SURMA: Maybe.

00:12:04.690 --> 00:12:05.240
That's a hunch.

00:12:05.240 --> 00:12:05.776
But yeah, it could--

00:12:05.776 --> 00:12:06.800
JAKE: We're only guessing.

00:12:06.800 --> 00:12:07.120
Brilliant.

00:12:07.120 --> 00:12:09.078
SURMA: But putting in a
global, that solved it.

00:12:09.078 --> 00:12:09.730
JAKE: Ta-da.

00:12:09.730 --> 00:12:11.080
SURMA: It looks even
worse in our code,

00:12:11.080 --> 00:12:12.370
because we are using TypeScript.

00:12:12.370 --> 00:12:13.912
So of course, we
have to ensure type.

00:12:13.912 --> 00:12:14.990
But this is actually OK?

00:12:14.990 --> 00:12:15.520
JAKE: Yeah, yeah.

00:12:15.520 --> 00:12:16.090
SURMA: It's great.

00:12:16.090 --> 00:12:16.590
JAKE: Chill.

00:12:16.590 --> 00:12:17.440
TypeScript, chill.

00:12:17.440 --> 00:12:17.940
We know we're doing
the bad thing.

00:12:17.940 --> 00:12:19.330
SURMA: We know what we're doing.

00:12:19.330 --> 00:12:20.485
JAKE: Yeah.

00:12:20.485 --> 00:12:22.860
SURMA: Number three-- I thought
it was quite interesting.

00:12:22.860 --> 00:12:23.400
JAKE: Oh, yes.

00:12:23.400 --> 00:12:24.550
SURMA: It's event inheritance.

00:12:24.550 --> 00:12:25.800
JAKE: I know what this one is.

00:12:25.800 --> 00:12:28.360
SURMA: So in Polymer
0.5 and 1.0 time,

00:12:28.360 --> 00:12:31.420
everything was
around custom events.

00:12:31.420 --> 00:12:31.920
JAKE: Yes.

00:12:31.920 --> 00:12:33.490
SURMA: CustomEvent class, and
putting your data in there

00:12:33.490 --> 00:12:34.330
and bubbling up.

00:12:34.330 --> 00:12:37.240
CustomEvent since has
been kind of deprecated.

00:12:37.240 --> 00:12:38.103
It's still around.

00:12:38.103 --> 00:12:40.270
I don't think it's implemented
everywhere, actually.

00:12:40.270 --> 00:12:42.062
JAKE: Well, CustomEvent
is weird, isn't it?

00:12:42.062 --> 00:12:44.060
Because when you
do New CustomEvent,

00:12:44.060 --> 00:12:46.650
you get an object to put
on whatever you want.

00:12:46.650 --> 00:12:47.200
SURMA: Yeah.

00:12:47.200 --> 00:12:49.290
JAKE: Which a lot of
stuff is moving away

00:12:49.290 --> 00:12:51.790
from these "whatever you want"
objects, especially if you're

00:12:51.790 --> 00:12:53.050
using things like TypeScript.

00:12:53.050 --> 00:12:55.240
You want to use an
event of a type.

00:12:55.240 --> 00:12:55.930
SURMA: Right.

00:12:55.930 --> 00:12:57.880
And so what you
usually end up doing

00:12:57.880 --> 00:13:01.560
is you build your own event
that extends an event.

00:13:01.560 --> 00:13:03.320
JAKE: That looks all fine to me.

00:13:03.320 --> 00:13:03.820
Yeah.

00:13:03.820 --> 00:13:05.320
SURMA: So same arguments.

00:13:05.320 --> 00:13:06.668
Now you can just put stuff--

00:13:06.668 --> 00:13:08.710
whatever you want to on
the event in a dictionary

00:13:08.710 --> 00:13:10.127
and grab the things
that you want.

00:13:10.127 --> 00:13:13.790
And now you can dispatch that
event, like any normal event.

00:13:13.790 --> 00:13:14.290
JAKE: Yep.

00:13:14.290 --> 00:13:15.520
SURMA: Great.

00:13:15.520 --> 00:13:18.389
Turns out, though, that
in Edge and iOS Safari--

00:13:18.389 --> 00:13:18.972
Edge is also--

00:13:18.972 --> 00:13:19.350
JAKE: Yep.

00:13:19.350 --> 00:13:19.930
It's all Safari.

00:13:19.930 --> 00:13:21.010
SURMA: All Safari this
time, not just iOS.

00:13:21.010 --> 00:13:21.635
JAKE: And Edge.

00:13:21.635 --> 00:13:22.420
Yep.

00:13:22.420 --> 00:13:26.080
SURMA: This extend event
turns out to not actually be

00:13:26.080 --> 00:13:27.277
inheriting from events.

00:13:27.277 --> 00:13:28.360
JAKE: It doesn't, does it?

00:13:28.360 --> 00:13:28.630
SURMA: No.

00:13:28.630 --> 00:13:29.130
JAKE: Yep.

00:13:29.130 --> 00:13:31.480
SURMA: And so in Squoosh,
we had a very simple fix.

00:13:31.480 --> 00:13:33.760
We basically just fixed it.

00:13:33.760 --> 00:13:35.920
After we have an instance
created with New,

00:13:35.920 --> 00:13:37.630
we just threw it
into another function

00:13:37.630 --> 00:13:39.460
that just fixed the prototype.

00:13:39.460 --> 00:13:40.223
JAKE: Fixed-- yes.

00:13:40.223 --> 00:13:41.890
SURMA: Just say, this
is your prototype.

00:13:41.890 --> 00:13:43.520
This is-- you are
actually in Event.

00:13:43.520 --> 00:13:44.020
JAKE: Yep.

00:13:44.020 --> 00:13:45.520
Swap that over.

00:13:45.520 --> 00:13:47.770
This bug-- the
behavior-- it comes

00:13:47.770 --> 00:13:54.460
from a very weird feature of
JavaScript, where a constructor

00:13:54.460 --> 00:13:56.010
can return a value.

00:13:56.010 --> 00:13:58.330
SURMA: Right.

00:13:58.330 --> 00:14:00.170
JAKE: Don't say "right"
like that's normal.

00:14:00.170 --> 00:14:01.700
SURMA: Right, question
mark, dot dot dot.

00:14:01.700 --> 00:14:02.533
JAKE: OK, thank you.

00:14:02.533 --> 00:14:04.040
[LAUGHTER]

00:14:04.040 --> 00:14:06.920
Well, a constructive function--
so you can return, like--

00:14:06.920 --> 00:14:07.960
SURMA: Four.

00:14:07.960 --> 00:14:08.460
JAKE: Yes.

00:14:08.460 --> 00:14:08.825
SURMA: [LAUGHS]

00:14:08.825 --> 00:14:10.658
JAKE: Or any number of
objects or something.

00:14:10.658 --> 00:14:12.675
And so when you do New
Thing, you actually

00:14:12.675 --> 00:14:14.300
get a completely
different object back.

00:14:14.300 --> 00:14:14.800
SURMA: Yeah.

00:14:14.800 --> 00:14:16.580
JAKE: And JavaScript is like--

00:14:16.580 --> 00:14:18.320
SURMA: [LAUGHS]

00:14:18.320 --> 00:14:19.430
JAKE: Why not?

00:14:19.430 --> 00:14:20.270
Why not?

00:14:20.270 --> 00:14:21.590
Do what you want.

00:14:21.590 --> 00:14:24.800
And we think that's what
the implementations in Edge

00:14:24.800 --> 00:14:25.925
and Safari are doing into--

00:14:25.925 --> 00:14:26.467
SURMA: Right.

00:14:26.467 --> 00:14:27.140
OK.

00:14:27.140 --> 00:14:28.610
JAKE: That's my theory, anyway.

00:14:28.610 --> 00:14:33.095
SURMA: Well, so we used our
own events in PROXX as well.

00:14:33.095 --> 00:14:33.595
JAKE: Yes.

00:14:33.595 --> 00:14:35.595
SURMA: And so I just
ripped this out of Squoosh,

00:14:35.595 --> 00:14:37.350
put it in PROXX, and
it still didn't work.

00:14:37.350 --> 00:14:37.940
JAKE: What?

00:14:37.940 --> 00:14:40.130
SURMA: Because it turns
out that in PROXX,

00:14:40.130 --> 00:14:42.955
we're compiling to ES5.

00:14:42.955 --> 00:14:43.455
JAKE: Oh!

00:14:43.455 --> 00:14:45.860
SURMA: Because we are
targeting Firefox 48 and older

00:14:45.860 --> 00:14:47.900
browsers, and so we needed ES5.

00:14:47.900 --> 00:14:53.150
And the way that both TypeScript
and also Babel, I guess,

00:14:53.150 --> 00:14:56.180
transpile classes to
functions with prototypes

00:14:56.180 --> 00:14:59.360
isn't quite compatible with
how the browsers expect

00:14:59.360 --> 00:15:03.390
the new event
constructor to work.

00:15:03.390 --> 00:15:03.890
JAKE: Oh!

00:15:03.890 --> 00:15:06.070
SURMA: So it literally just
panics at construction.

00:15:06.070 --> 00:15:06.570
JAKE: I see.

00:15:06.570 --> 00:15:09.480
SURMA: So what we
did instead in PROXX,

00:15:09.480 --> 00:15:11.990
is we just rolled our
own factory functions.

00:15:11.990 --> 00:15:13.520
JAKE: State change
event factory.

00:15:13.520 --> 00:15:14.270
Brilliant.

00:15:14.270 --> 00:15:17.690
SURMA: So instead of saying,
creating a proper state change

00:15:17.690 --> 00:15:20.790
event function or class,
we just wrote a function

00:15:20.790 --> 00:15:24.630
that creates a new event and
then changes the prototype.

00:15:24.630 --> 00:15:25.130
JAKE: Right.

00:15:25.130 --> 00:15:27.110
So we went from doing
this horrible hack

00:15:27.110 --> 00:15:29.478
for just Edge and Safari
to doing it for everyone.

00:15:29.478 --> 00:15:30.020
SURMA: Right.

00:15:30.020 --> 00:15:30.250
JAKE: Brilliant.

00:15:30.250 --> 00:15:30.870
Fine.

00:15:30.870 --> 00:15:33.740
SURMA: It still works, but it's
just a function that exists,

00:15:33.740 --> 00:15:36.210
and it wasn't
necessary, because ES5--

00:15:36.210 --> 00:15:36.860
JAKE: That is--

00:15:36.860 --> 00:15:39.050
I think that's-- it's on
the developer coat of arms,

00:15:39.050 --> 00:15:39.590
isn't it?

00:15:39.590 --> 00:15:40.410
"But it works."

00:15:40.410 --> 00:15:41.130
SURMA: Yeah, pretty much.

00:15:41.130 --> 00:15:41.797
JAKE: It's fine.

00:15:41.797 --> 00:15:42.670
SURMA: Pretty much.

00:15:42.670 --> 00:15:43.580
JAKE: Excellent.

00:15:43.580 --> 00:15:47.150
SURMA: I tried, I think, for an
hour to somehow actually have

00:15:47.150 --> 00:15:50.360
a proper ES5
constructor function

00:15:50.360 --> 00:15:51.350
that is a proper event.

00:15:51.350 --> 00:15:52.460
I couldn't get it to work.

00:15:52.460 --> 00:15:52.910
JAKE: I-- yeah.

00:15:52.910 --> 00:15:54.630
SURMA: I just couldn't
get it to work.

00:15:54.630 --> 00:15:55.330
And so I was like, all right.

00:15:55.330 --> 00:15:55.630
You know what?

00:15:55.630 --> 00:15:56.240
Factory function.

00:15:56.240 --> 00:15:58.190
Just one place where [INAUDIBLE]
you just only have one custom

00:15:58.190 --> 00:15:58.815
event, I think.

00:15:58.815 --> 00:15:59.398
JAKE: Mm-hmm.

00:15:59.398 --> 00:16:00.440
SURMA: Don't care enough.

00:16:00.440 --> 00:16:01.090
JAKE: Job done.

00:16:01.090 --> 00:16:01.322
SURMA: Right.

00:16:01.322 --> 00:16:01.840
JAKE: Fine.

00:16:01.840 --> 00:16:02.340
OK.

00:16:02.340 --> 00:16:07.280
SURMA: And for the grand finale,
we have the hide-y address bar.

00:16:07.280 --> 00:16:08.540
JAKE: The hide-y address bar.

00:16:08.540 --> 00:16:09.610
Excellent.

00:16:09.610 --> 00:16:10.370
OK.

00:16:10.370 --> 00:16:12.380
SURMA: Everybody probably knows
that if you are on like a blog

00:16:12.380 --> 00:16:14.510
website with your mobile
browser and you scroll down,

00:16:14.510 --> 00:16:15.230
the address bar--

00:16:15.230 --> 00:16:15.540
SURMA: Hides.

00:16:15.540 --> 00:16:15.840
JAKE: Hide-y.

00:16:15.840 --> 00:16:16.280
Yeah.

00:16:16.280 --> 00:16:16.560
SURMA: Hide-y.

00:16:16.560 --> 00:16:17.360
JAKE: It's hiding.

00:16:17.360 --> 00:16:19.652
SURMA: And you scroll back
up, it comes back into view.

00:16:19.652 --> 00:16:20.670
JAKE: Come back-y.

00:16:20.670 --> 00:16:23.930
SURMA: The problem with that
is that different browsers seem

00:16:23.930 --> 00:16:27.530
to be behaving differently--
what 100% height

00:16:27.530 --> 00:16:30.240
or what 100 vh means
in this context.

00:16:30.240 --> 00:16:30.740
JAKE: Yes.

00:16:30.740 --> 00:16:35.220
SURMA: Some browsers
seem to think

00:16:35.220 --> 00:16:36.480
the address box is overlay.

00:16:36.480 --> 00:16:37.230
Some don't.

00:16:37.230 --> 00:16:39.910
Sometimes only the vh
for vh is on overlay,

00:16:39.910 --> 00:16:41.370
but the percent it is.

00:16:41.370 --> 00:16:43.980
And then there is web views,
which again behave differently

00:16:43.980 --> 00:16:45.660
on both Android and iOS.

00:16:45.660 --> 00:16:47.970
And we ran into
this with our game,

00:16:47.970 --> 00:16:49.940
because we wanted to
use natural scrolling.

00:16:49.940 --> 00:16:54.138
So our game field is actually
the actual site content,

00:16:54.138 --> 00:16:55.680
and the bars are
just fixed position.

00:16:55.680 --> 00:16:57.427
So it was using normal
browser scrolling.

00:16:57.427 --> 00:16:59.760
So that means if you scroll
down, [INAUDIBLE] will hide.

00:16:59.760 --> 00:17:02.280
Everything would re-jiggle
and jank, and that was stupid.

00:17:02.280 --> 00:17:02.368
JAKE: Yeah.

00:17:02.368 --> 00:17:02.910
SURMA: Then you scroll back up.

00:17:02.910 --> 00:17:04.410
Everything came back into view.

00:17:04.410 --> 00:17:05.810
And so we thought,
you know what?

00:17:05.810 --> 00:17:08.190
We're going to disable
the hide-y address bar.

00:17:08.190 --> 00:17:10.770
JAKE: So the differences
across browsers at this point--

00:17:10.770 --> 00:17:15.240
I think iOS and Chrome have
made a conscious decision

00:17:15.240 --> 00:17:19.109
to try and do the same
thing as each other.

00:17:19.109 --> 00:17:23.280
But iOS and Chrome both
do different things

00:17:23.280 --> 00:17:24.780
with different bits of CSS.

00:17:24.780 --> 00:17:27.290
So-- ah.

00:17:27.290 --> 00:17:28.290
I'm trying to remember--

00:17:28.290 --> 00:17:28.626
SURMA: Ah!

00:17:28.626 --> 00:17:28.962
JAKE: Ah!

00:17:28.962 --> 00:17:29.131
Bah!

00:17:29.131 --> 00:17:29.631
Bah!

00:17:29.631 --> 00:17:30.310
SURMA: [LAUGHS]

00:17:30.310 --> 00:17:32.490
JAKE: I'm trying to remember
off the top of my head.

00:17:32.490 --> 00:17:36.690
It's 100 vh-- means a particular
thing, unless the element is

00:17:36.690 --> 00:17:37.670
position fixed.

00:17:37.670 --> 00:17:39.580
In which case, it means
a different thing.

00:17:39.580 --> 00:17:43.498
And that is-- position
fixed changes the rules,

00:17:43.498 --> 00:17:44.790
and that's what we were seeing.

00:17:44.790 --> 00:17:47.310
So we had the bottom bar
that was position fixed,

00:17:47.310 --> 00:17:48.575
and that was kind of like--

00:17:48.575 --> 00:17:49.950
SURMA: Oh, it was
jumping around.

00:17:49.950 --> 00:17:51.700
JAKE: Jumping around.

00:17:51.700 --> 00:17:53.473
SURMA: Either way,
it was annoying.

00:17:53.473 --> 00:17:54.390
JAKE: It was annoying.

00:17:54.390 --> 00:17:54.890
Yeah.

00:17:54.890 --> 00:17:56.910
SURMA: And so we
thought the easiest way

00:17:56.910 --> 00:17:59.590
to fix this is just to do
scrolling on an element.

00:17:59.590 --> 00:18:00.090
JAKE: Yeah.

00:18:00.090 --> 00:18:02.215
We abandoned the full page
natural scrolling thing.

00:18:02.215 --> 00:18:04.465
SURMA: So what we did, we
used our main element, which

00:18:04.465 --> 00:18:05.790
is where the game field was in.

00:18:05.790 --> 00:18:08.550
Or our entire UI
was in, basically.

00:18:08.550 --> 00:18:11.010
Just [INAUDIBLE] made it
the size of the screen,

00:18:11.010 --> 00:18:12.280
overflow auto, boom.

00:18:12.280 --> 00:18:12.780
Scrolling.

00:18:12.780 --> 00:18:14.030
JAKE: [GROWLS]

00:18:14.030 --> 00:18:14.770
SURMA: I know.

00:18:14.770 --> 00:18:16.420
JAKE: I hate this.

00:18:16.420 --> 00:18:20.250
I hate that it's 2019, and
we still have to do a special

00:18:20.250 --> 00:18:22.307
thing to make scrolling
work properly, and it's--

00:18:22.307 --> 00:18:23.140
SURMA: It's the web.

00:18:23.140 --> 00:18:23.450
JAKE: OK.

00:18:23.450 --> 00:18:23.950
[SIGHS]

00:18:23.950 --> 00:18:24.750
SURMA: It's homely.

00:18:24.750 --> 00:18:25.260
JAKE: Right.

00:18:25.260 --> 00:18:26.220
Yes.

00:18:26.220 --> 00:18:27.952
SURMA: And so this--

00:18:27.952 --> 00:18:29.670
JAKE: This is a
bit new, isn't it?

00:18:29.670 --> 00:18:34.060
I didn't know much about
this until we did it.

00:18:34.060 --> 00:18:34.560
SURMA: Yeah.

00:18:34.560 --> 00:18:36.720
This is basically
saying to overscroll.

00:18:36.720 --> 00:18:37.220
JAKE: Yes.

00:18:37.220 --> 00:18:39.660
SURMA: The thing where when
you scroll, you're at the top

00:18:39.660 --> 00:18:42.590
and try to scroll further top,
it bends it down a little bit

00:18:42.590 --> 00:18:43.590
or snaps back into view.

00:18:43.590 --> 00:18:44.460
JAKE: Like a shadow
or something.

00:18:44.460 --> 00:18:46.210
SURMA: Which in this
case, we didn't want.

00:18:46.210 --> 00:18:47.470
So we [INAUDIBLE].

00:18:47.470 --> 00:18:47.970
JAKE: Yes.

00:18:47.970 --> 00:18:49.590
SURMA: But it's more about--

00:18:49.590 --> 00:18:53.080
it's a screen-filling
element that can scroll,

00:18:53.080 --> 00:18:55.740
and it fixed it in
iOS Safari, I think.

00:18:55.740 --> 00:18:56.400
JAKE: Mm-hmm.

00:18:56.400 --> 00:18:58.320
SURMA: But Chrome,
the odd browser--

00:18:58.320 --> 00:18:59.790
JAKE: Oh.

00:18:59.790 --> 00:19:02.338
SURMA: --was like,
you know what?

00:19:02.338 --> 00:19:03.630
This looks like you're trying--

00:19:03.630 --> 00:19:05.060
JAKE: I'd forgotten about this.

00:19:05.060 --> 00:19:06.210
I blocked this out.

00:19:06.210 --> 00:19:08.010
SURMA: [LAUGHS]
Chrome was like, I

00:19:08.010 --> 00:19:10.200
think you're trying
to do a page scroller,

00:19:10.200 --> 00:19:13.080
so I'm going to give you
our great hide-y address bar

00:19:13.080 --> 00:19:14.820
behavior for free.

00:19:14.820 --> 00:19:15.600
JAKE: It did.

00:19:15.600 --> 00:19:16.990
Oh, of course it did.

00:19:16.990 --> 00:19:18.240
I really had blocked this out.

00:19:18.240 --> 00:19:19.710
You've gone through
all the commits

00:19:19.710 --> 00:19:20.590
then, where we've
just gone through--

00:19:20.590 --> 00:19:20.770
SURMA: No.

00:19:20.770 --> 00:19:21.450
I remembered this.

00:19:21.450 --> 00:19:22.420
JAKE: You actually
remembered this.

00:19:22.420 --> 00:19:22.466
SURMA: Yeah.

00:19:22.466 --> 00:19:23.400
It's first one I put in.

00:19:23.400 --> 00:19:24.233
JAKE: Oh, brilliant.

00:19:24.233 --> 00:19:24.770
OK.

00:19:24.770 --> 00:19:25.270
Yeah.

00:19:25.270 --> 00:19:27.990
SURMA: And if you remember our
fix, you know how great it is.

00:19:27.990 --> 00:19:29.548
JAKE: Yes, I do.

00:19:29.548 --> 00:19:30.840
SURMA: We looked at this line--

00:19:30.840 --> 00:19:31.548
JAKE: Yep, I did.

00:19:31.548 --> 00:19:33.370
SURMA: And we said,
we can spare a pixel.

00:19:33.370 --> 00:19:34.120
JAKE: There we go.

00:19:34.120 --> 00:19:35.560
[LAUGHTER]

00:19:35.560 --> 00:19:38.380
SURMA: So this was clearly
Chrome trying to be helpful--

00:19:38.380 --> 00:19:39.970
trying to do the right thing.

00:19:39.970 --> 00:19:41.270
JAKE: And failing.

00:19:41.270 --> 00:19:41.770
It was--

00:19:41.770 --> 00:19:43.000
SURMA: It made us so angry.

00:19:43.000 --> 00:19:43.610
JAKE: Yes.

00:19:43.610 --> 00:19:45.130
SURMA: Because we still
got that address bar hide-y

00:19:45.130 --> 00:19:47.360
janky jumpy thing, and
we didn't want it at all.

00:19:47.360 --> 00:19:47.860
JAKE: Yes.

00:19:47.860 --> 00:19:50.094
It's like, we're doing
this so you don't do that.

00:19:50.094 --> 00:19:52.470
SURMA: So there must be a
heuristic somewhere in our code

00:19:52.470 --> 00:19:54.570
that says, if you're
position [INAUDIBLE] fills

00:19:54.570 --> 00:19:57.802
the entire screen, do the
[INAUDIBLE] hide-y bar attached

00:19:57.802 --> 00:19:58.510
to this scroller.

00:19:58.510 --> 00:19:59.530
You know, the root scroller.

00:19:59.530 --> 00:19:59.740
JAKE: Yes.

00:19:59.740 --> 00:20:01.330
SURMA: And so we
added the pixel.

00:20:01.330 --> 00:20:04.200
JAKE: We added the pixel,
and that was enough.

00:20:04.200 --> 00:20:05.240
Oh, my-- oh.

00:20:05.240 --> 00:20:05.740
Ah.

00:20:05.740 --> 00:20:06.448
SURMA: I like it.

00:20:06.448 --> 00:20:08.050
It's still PTSD going on here--

00:20:08.050 --> 00:20:08.680
JAKE: I am--

00:20:08.680 --> 00:20:10.972
SURMA: --from the weird,
weird workarounds that we have

00:20:10.972 --> 00:20:11.515
encountered--

00:20:11.515 --> 00:20:12.015
JAKE: Yes.

00:20:12.015 --> 00:20:12.938
SURMA: --during--

00:20:12.938 --> 00:20:14.230
JAKE: I'd forgotten about that.

00:20:14.230 --> 00:20:15.897
We should file a bug
for that, because--

00:20:15.897 --> 00:20:18.410
or we should have a
way to avoid that.

00:20:18.410 --> 00:20:22.060
So that's four stupid hacks
to fix four different bro--

00:20:22.060 --> 00:20:23.770
is it four browsers?

00:20:23.770 --> 00:20:24.700
SURMA: Two or three.

00:20:24.700 --> 00:20:25.630
JAKE: Three browsers.

00:20:25.630 --> 00:20:27.145
And-- yeah.

00:20:27.145 --> 00:20:29.020
SURMA: It's really just
a web developer life.

00:20:29.020 --> 00:20:30.670
This is, I feel
like what, if you're

00:20:30.670 --> 00:20:32.170
trying to get
something out in time,

00:20:32.170 --> 00:20:34.630
you have to make these
stupid shortcuts.

00:20:34.630 --> 00:20:36.890
JAKE: You've got the
correct path, but--

00:20:36.890 --> 00:20:38.140
SURMA: You have the fast path.

00:20:38.140 --> 00:20:38.650
JAKE: The road's out.

00:20:38.650 --> 00:20:39.010
SURMA: [LAUGHS]

00:20:39.010 --> 00:20:40.718
JAKE: And you've got
to-- (MOANING) blah.

00:20:40.718 --> 00:20:41.230
SURMA: Yep.

00:20:41.230 --> 00:20:41.865
JAKE: That's web development.

00:20:41.865 --> 00:20:43.000
That (MOANING) blah.

00:20:43.000 --> 00:20:44.050
SURMA: Bottom one pixel.

00:20:44.050 --> 00:20:45.552
That's what that is.

00:20:45.552 --> 00:20:46.860
[MUSIC PLAYING]

00:20:46.860 --> 00:20:47.360
Yes.

00:20:47.360 --> 00:20:50.138
JAKE: Because that was stupid.

00:20:50.138 --> 00:20:50.680
SURMA: Right.

00:20:50.680 --> 00:20:51.850
JAKE: That's what I'm saying.

00:20:51.850 --> 00:20:53.550
SURMA: That's a good
ending for this episode.

00:20:53.550 --> 00:20:53.855
JAKE: [LAUGHS]

00:20:53.855 --> 00:20:54.520
SURMA: Stupid.

00:20:54.520 --> 00:20:58.130
JAKE: Four stupid things
by four stupid browsers.

00:20:58.130 --> 00:21:02.010
Actually, we're only blaming
two browsers, isn't it?

