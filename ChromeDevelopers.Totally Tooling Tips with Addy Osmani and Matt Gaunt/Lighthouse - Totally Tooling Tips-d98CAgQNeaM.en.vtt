WEBVTT
Kind: captions
Language: en

00:00:00.000 --> 00:00:03.409
[MUSIC PLAYING]

00:00:09.775 --> 00:00:11.400
ADDY OSMANI: All
right, welcome to TTT.

00:00:11.400 --> 00:00:14.460
Today, we're going to talk about
Lighthouse and Lighthouse NCI.

00:00:14.460 --> 00:00:18.360
With us today is our
special guest Eric Bidelman.

00:00:18.360 --> 00:00:19.990
Eric hacks on Lighthouse.

00:00:19.990 --> 00:00:21.030
What is Lighthouse?

00:00:21.030 --> 00:00:21.930
Why should we care about it?

00:00:21.930 --> 00:00:22.790
ERIC BIDELMAN:
Yeah, so Lighthouse

00:00:22.790 --> 00:00:25.500
is a tool that we've been
developing on the Chrome team

00:00:25.500 --> 00:00:27.750
for about a year and
a half now, and it's

00:00:27.750 --> 00:00:31.210
a tool for web developers
to audit their sites.

00:00:31.210 --> 00:00:33.300
It tells you things
about best practices.

00:00:33.300 --> 00:00:34.950
It gives you performance scores.

00:00:34.950 --> 00:00:37.440
It tells you if your site's
a progressive web app or not.

00:00:37.440 --> 00:00:38.898
It kind of lists
off the things you

00:00:38.898 --> 00:00:40.482
need to do in order
to make it better.

00:00:40.482 --> 00:00:42.189
MATT GAUNT: Yeah, and
you've been working

00:00:42.189 --> 00:00:43.440
on this for quite awhile now.

00:00:43.440 --> 00:00:46.141
I think it start off
as sort of a Node CLI,

00:00:46.141 --> 00:00:48.390
and then there was the Chrome
extension, which kind of

00:00:48.390 --> 00:00:49.950
has been like super popular.

00:00:49.950 --> 00:00:51.900
But you've been moving
it around since then.

00:00:51.900 --> 00:00:52.410
Right?

00:00:52.410 --> 00:00:54.618
ERIC BIDELMAN: Yeah, it's
kind of grown up over time.

00:00:54.618 --> 00:00:56.181
It started off as
the Node module,

00:00:56.181 --> 00:00:58.680
so you can programmatically run
this thing against your site

00:00:58.680 --> 00:00:59.564
if you're in Node.

00:00:59.564 --> 00:01:01.230
And then we develop
the Chrome extension

00:01:01.230 --> 00:01:03.854
because people just really want
to press a button against a URL

00:01:03.854 --> 00:01:05.700
and get some
numbers and a score.

00:01:05.700 --> 00:01:07.980
And over time, as the open
source project has kind of

00:01:07.980 --> 00:01:11.770
grown up-- we've released it
in other places like Dev Tools.

00:01:11.770 --> 00:01:14.940
So now in Chrome Stable,
if you open the Dev Tools,

00:01:14.940 --> 00:01:17.550
you can basically go
to the new Audits panel

00:01:17.550 --> 00:01:19.510
and, voila, instead
of the old school

00:01:19.510 --> 00:01:21.556
Audits panel that we had
for many, many moons,

00:01:21.556 --> 00:01:24.560
you have the new version,
which includes Lighthouse.

00:01:24.560 --> 00:01:25.560
So you can go to a site.

00:01:25.560 --> 00:01:26.130
You can run.

00:01:26.130 --> 00:01:28.560
You can choose which performance
categories, [INAUDIBLE]

00:01:28.560 --> 00:01:29.400
categories you want.

00:01:29.400 --> 00:01:30.690
You run it against your site.

00:01:30.690 --> 00:01:33.270
Will emulate a mobile device,
throttle down the connection

00:01:33.270 --> 00:01:35.160
to make sure your
performance numbers are

00:01:35.160 --> 00:01:37.860
realistic to the real
world if somebody's viewing

00:01:37.860 --> 00:01:39.510
your site on a mobile device.

00:01:39.510 --> 00:01:40.650
And we run a bunch
of stuff, so you'll

00:01:40.650 --> 00:01:42.150
see the page reload
a couple of times,

00:01:42.150 --> 00:01:44.220
and that's just because we
have to test for things like is

00:01:44.220 --> 00:01:45.390
your site working offline.

00:01:45.390 --> 00:01:47.660
We want to shut the network
connection off, make

00:01:47.660 --> 00:01:50.416
sure you're using a
service worker or your PWA,

00:01:50.416 --> 00:01:52.290
run performance audits,
accessibility audits.

00:01:52.290 --> 00:01:55.480
And eventually, we'll get
this really nice report that

00:01:55.480 --> 00:01:58.200
basically shows you what you're
doing great at-- here we go--

00:01:58.200 --> 00:01:59.680
and what you could improve upon.

00:01:59.680 --> 00:02:02.250
So Chrome Status is a
good example of PWA.

00:02:02.250 --> 00:02:03.727
I spent some time making a PWA.

00:02:03.727 --> 00:02:06.310
MATT GAUNT: I was going to say,
who built Chrome Status, Eric?

00:02:06.310 --> 00:02:07.893
ERIC BIDELMAN: Yeah,
so there is that.

00:02:07.893 --> 00:02:10.804
We have hundreds-- out
of 100 for the PWA score,

00:02:10.804 --> 00:02:12.720
and you can see in here
all the different kind

00:02:12.720 --> 00:02:14.015
of things we test for.

00:02:14.015 --> 00:02:15.390
So there's a lot
of stuff in here

00:02:15.390 --> 00:02:18.630
I highly recommend
checking out, diving in.

00:02:18.630 --> 00:02:21.000
Really good, interesting
performance section,

00:02:21.000 --> 00:02:23.250
some newer metrics like
first meaningful [INAUDIBLE],,

00:02:23.250 --> 00:02:25.470
time to interactive,
probably things you guys

00:02:25.470 --> 00:02:27.670
have covered extensively
on the show here.

00:02:27.670 --> 00:02:29.130
ADDY OSMANI: No, first time
we're ever covering this.

00:02:29.130 --> 00:02:29.520
ERIC BIDELMAN: Yeah.

00:02:29.520 --> 00:02:30.940
ADDY OSMANI: Ever in history.

00:02:30.940 --> 00:02:31.350
ERIC BIDELMAN:
But there's just--

00:02:31.350 --> 00:02:32.520
there's new stuff
happening all the time.

00:02:32.520 --> 00:02:35.312
We're adding new audits, so
as new best practices emerge

00:02:35.312 --> 00:02:37.770
or the requirements for being
a progressive web app change,

00:02:37.770 --> 00:02:39.120
we're going to add
that stuff and just

00:02:39.120 --> 00:02:40.244
make the whole tool better.

00:02:40.244 --> 00:02:43.049
MATT GAUNT: And then [INAUDIBLE]
new web standards kind of land,

00:02:43.049 --> 00:02:45.090
you can start seeing people
basically add audits,

00:02:45.090 --> 00:02:46.980
and then it's instantly going to
start appearing in Lighthouse,

00:02:46.980 --> 00:02:50.087
and it's kind of a nice way of
keeping up to date with newer

00:02:50.087 --> 00:02:50.670
web standards.

00:02:50.670 --> 00:02:50.990
Right?

00:02:50.990 --> 00:02:52.590
ERIC BIDELMAN: Yeah, and
that's one of the goals,

00:02:52.590 --> 00:02:54.870
is there's all these best
practices you learn over time,

00:02:54.870 --> 00:02:56.119
but some are kind of outdated.

00:02:56.119 --> 00:02:59.920
You don't know what's
relevant or not in 2017.

00:02:59.920 --> 00:03:02.640
And so we just want to add this
to a tool that's open source.

00:03:02.640 --> 00:03:05.770
It's on GitHub, and now it's
built into the browser itself,

00:03:05.770 --> 00:03:08.220
so you can use it basically
anywhere you want.

00:03:08.220 --> 00:03:08.760
ADDY OSMANI: That's awesome.

00:03:08.760 --> 00:03:10.980
I love that it's got those
modern loading metrics going

00:03:10.980 --> 00:03:12.480
there, and it's
also got the section

00:03:12.480 --> 00:03:15.480
for your critical
network request chains.

00:03:15.480 --> 00:03:16.830
Really useful to look at.

00:03:16.830 --> 00:03:20.640
So Lighthouse is great for
your local dev workflow,

00:03:20.640 --> 00:03:22.890
checking your own performance
on your local machine,

00:03:22.890 --> 00:03:24.570
but it's important
to be continuously

00:03:24.570 --> 00:03:26.540
testing this stuff out.

00:03:26.540 --> 00:03:28.800
Does Lighthouse work in
continuous integration

00:03:28.800 --> 00:03:31.830
with things like Travis, and if
so, can we have it now please,

00:03:31.830 --> 00:03:32.414
Eric, and how?

00:03:32.414 --> 00:03:34.288
ERIC BIDELMAN: Well,
I'm glad you asked that.

00:03:34.288 --> 00:03:34.920
Indeed, we can.

00:03:34.920 --> 00:03:37.020
Something we showed
at Google I/O

00:03:37.020 --> 00:03:40.320
is the ability to basically
just hook up headless Chrome

00:03:40.320 --> 00:03:41.880
and Lighthouse to GitHub.

00:03:41.880 --> 00:03:43.710
So someone submits a
pull request to you.

00:03:43.710 --> 00:03:45.626
You want to know if that
pull request is going

00:03:45.626 --> 00:03:48.090
to hurt your performance,
accessibility, best practices,

00:03:48.090 --> 00:03:50.710
or if it's going to
make it better or not.

00:03:50.710 --> 00:03:51.990
So you can totally do that.

00:03:51.990 --> 00:03:54.635
I've actually been experimenting
with that over on GitHub.

00:03:54.635 --> 00:03:55.510
You can check it out.

00:03:55.510 --> 00:03:59.370
It's
github.com/ebidel/lighthouse-ci.

00:03:59.370 --> 00:04:01.890
And basically what this is,
it's just a Docker image

00:04:01.890 --> 00:04:03.540
that we've put on Google Cloud.

00:04:03.540 --> 00:04:05.220
So it's on App Engine.

00:04:05.220 --> 00:04:06.780
It runs Docker, runs
headless Chrome,

00:04:06.780 --> 00:04:09.090
and it basically sends off
your GitHub pull requests

00:04:09.090 --> 00:04:11.910
as they come into
this Rest endpoint.

00:04:11.910 --> 00:04:14.040
It stages and tests
and then gives you

00:04:14.040 --> 00:04:15.982
your Lighthouse score.

00:04:15.982 --> 00:04:17.940
So that's pretty nice
because you can basically

00:04:17.940 --> 00:04:20.023
have this little Lighthouse
following you wherever

00:04:20.023 --> 00:04:22.841
you go, and this is an example
of what this tool actually

00:04:22.841 --> 00:04:23.340
does.

00:04:23.340 --> 00:04:24.940
So it'll report on
your pull request.

00:04:24.940 --> 00:04:26.940
It'll comment saying,
hey, this pull request is

00:04:26.940 --> 00:04:28.380
going to be 100 of 100 now.

00:04:28.380 --> 00:04:29.170
No worries.

00:04:29.170 --> 00:04:31.090
You're safe to merge.

00:04:31.090 --> 00:04:33.280
MATT GAUNT: So do you
have to stay to your site

00:04:33.280 --> 00:04:35.650
and then tell the CI,
this is your role,

00:04:35.650 --> 00:04:37.970
I want to run this pull request?

00:04:37.970 --> 00:04:39.190
ERIC BIDELMAN: You do.

00:04:39.190 --> 00:04:40.770
I'll just show you right here.

00:04:40.770 --> 00:04:41.590
It's just Travis.

00:04:41.590 --> 00:04:43.364
So you drop in a
Travis YAML file,

00:04:43.364 --> 00:04:45.280
and you run this little
script that I created.

00:04:45.280 --> 00:04:47.116
And that script,
called runlighthouse,

00:04:47.116 --> 00:04:49.240
just handles the details
of commenting on your pull

00:04:49.240 --> 00:04:52.630
request, and sending the
pull request to this Docker

00:04:52.630 --> 00:04:54.275
image in the cloud.

00:04:54.275 --> 00:04:55.900
And then all you do
in your Travis file

00:04:55.900 --> 00:04:59.510
is have your usual
install handler, your npm

00:04:59.510 --> 00:05:02.500
link, or whatever you have
to do to test your site.

00:05:02.500 --> 00:05:05.262
And then in
after_success, the stuff

00:05:05.262 --> 00:05:06.970
you mentioned, which
is deploy your site.

00:05:06.970 --> 00:05:09.730
We want folks to deploy
their pull request changes

00:05:09.730 --> 00:05:12.215
to a staging URL,
because we think

00:05:12.215 --> 00:05:14.950
it will give more realistic
performance numbers.

00:05:14.950 --> 00:05:16.840
If you run locally
on localhost, and you

00:05:16.840 --> 00:05:19.570
don't have things like
SSL, for instance, you

00:05:19.570 --> 00:05:22.330
don't have an H2PUSH,
so there's going

00:05:22.330 --> 00:05:24.790
to be different performance
characteristics if you don't

00:05:24.790 --> 00:05:26.367
send it to a staging server.

00:05:26.367 --> 00:05:27.700
But it's basically just drop in.

00:05:27.700 --> 00:05:29.300
And you call this little
runlighthouse script,

00:05:29.300 --> 00:05:31.174
you give it the URL you
want to test against,

00:05:31.174 --> 00:05:33.799
your staging server URL.

00:05:33.799 --> 00:05:35.590
And then lightousebot
will do the hard work

00:05:35.590 --> 00:05:37.156
of reporting back
the new scores,

00:05:37.156 --> 00:05:38.530
commenting on your
pull requests,

00:05:38.530 --> 00:05:41.200
and letting you know what's up.

00:05:41.200 --> 00:05:44.320
MATT GAUNT: So because it's
running in headless Chrome,

00:05:44.320 --> 00:05:46.990
does that affect the
performance scores and stuff,

00:05:46.990 --> 00:05:50.410
and is there any way of
basically getting around that,

00:05:50.410 --> 00:05:52.079
so it's a bit more realistic?

00:05:52.079 --> 00:05:53.620
ERIC BIDELMAN: So
right now actually,

00:05:53.620 --> 00:05:55.328
and I'm glad you asked
that, because it's

00:05:55.328 --> 00:05:56.800
a real important point.

00:05:56.800 --> 00:05:58.827
Inside of this
repo, it's a tool we

00:05:58.827 --> 00:06:00.910
have online that people
can just drop into Github,

00:06:00.910 --> 00:06:04.600
but it's also a reference
server, and a docker image

00:06:04.600 --> 00:06:07.250
that people can run their
own setup if they wanted to.

00:06:07.250 --> 00:06:09.110
But I have two different
Docker files here.

00:06:09.110 --> 00:06:11.770
One is for headless
Chrome, so test my site

00:06:11.770 --> 00:06:14.650
using headless Chrome, and
also using full Chrome, so

00:06:14.650 --> 00:06:16.810
non-headless version of Chrome.

00:06:16.810 --> 00:06:19.420
And so the CI's actually using
the non-headless one right now,

00:06:19.420 --> 00:06:22.960
because there's some bugs
with headless Chrome on--

00:06:22.960 --> 00:06:24.880
basically you can't do
throttling and network

00:06:24.880 --> 00:06:26.560
emulation in headless right now.

00:06:26.560 --> 00:06:28.360
So it's not going
to be entirely--

00:06:28.360 --> 00:06:30.870
you're basically going to
get better scores than you'd

00:06:30.870 --> 00:06:31.370
expect.

00:06:31.370 --> 00:06:34.081
And we want the most
realistic ones possible.

00:06:34.081 --> 00:06:34.580
Yeah.

00:06:34.580 --> 00:06:36.172
A couple of options, though.

00:06:36.172 --> 00:06:36.880
MATT GAUNT: Nice.

00:06:36.880 --> 00:06:38.622
So you can use it as
a Chrome extension,

00:06:38.622 --> 00:06:40.830
but there's no real need
for that, because you got it

00:06:40.830 --> 00:06:42.100
in dev tools now.

00:06:42.100 --> 00:06:46.030
Is it any other way you can
use it after the CI as well?

00:06:46.030 --> 00:06:47.357
Nudge nudge, WebPagetest?

00:06:47.357 --> 00:06:48.690
ERIC BIDELMAN: WebPagetest, yes.

00:06:48.690 --> 00:06:49.940
And actually we've integrated.

00:06:49.940 --> 00:06:51.790
We've worked with the
folks at WebPagetest

00:06:51.790 --> 00:06:53.590
to integrate lighthouse.

00:06:53.590 --> 00:06:57.082
So if you're on WebPagetest, you
can pop over to Simple Testing.

00:06:57.082 --> 00:06:58.540
Inside of here,
you can see there's

00:06:58.540 --> 00:07:00.594
a checkbox for Run Lighthouse.

00:07:00.594 --> 00:07:03.010
And when you do this, you're
going to get your typical web

00:07:03.010 --> 00:07:05.855
page test results, but you'll
also have the lighthouse report

00:07:05.855 --> 00:07:08.230
that you saw, that we just
saw in the dev tools, show up.

00:07:08.230 --> 00:07:10.984
So you can get all this
information in a single place,

00:07:10.984 --> 00:07:12.400
if you're already
using this tool.

00:07:12.400 --> 00:07:14.733
ADDY OSMANI: And the benefit
of this versus just running

00:07:14.733 --> 00:07:18.220
it locally is you can also
run on a real device, Moto G4,

00:07:18.220 --> 00:07:21.270
and get slightly more
realistic performance numbers

00:07:21.270 --> 00:07:22.080
off the back of it.

00:07:22.080 --> 00:07:23.163
ERIC BIDELMAN: Definitely.

00:07:23.163 --> 00:07:25.810
One of the coolest things
about WebPagetest in general

00:07:25.810 --> 00:07:27.400
is there's all these
different places

00:07:27.400 --> 00:07:31.090
you can test, in a bunch of
different versions of browsers

00:07:31.090 --> 00:07:32.210
and devices.

00:07:32.210 --> 00:07:33.965
So you get realistic numbers.

00:07:33.965 --> 00:07:34.840
ADDY OSMANI: Awesome.

00:07:34.840 --> 00:07:37.200
So a plethora of options.

00:07:37.200 --> 00:07:38.344
Folks should check it out.

00:07:38.344 --> 00:07:39.010
MATT GAUNT: Yep.

00:07:39.010 --> 00:07:41.166
I'd just get it in your
CI, so you don't trip up.

00:07:41.166 --> 00:07:42.540
That's what I've
done on my site,

00:07:42.540 --> 00:07:44.710
but I've been customizing
it like no end.

00:07:44.710 --> 00:07:45.460
So I'm glad that--

00:07:45.460 --> 00:07:46.210
ERIC BIDELMAN:
It's open sourcing,

00:07:46.210 --> 00:07:46.840
you can do whatever you want.

00:07:46.840 --> 00:07:48.048
Customize the snot out of it.

00:07:48.048 --> 00:07:49.130
ADDY OSMANI: Awesome.

00:07:49.130 --> 00:07:51.032
So check out lighthouse,
try it in CI.

00:07:51.032 --> 00:07:52.240
Thanks for dropping by, Eric.

00:07:52.240 --> 00:07:52.570
ERIC BIDELMAN: Thanks, guys.

00:07:52.570 --> 00:07:53.792
Appreciate it.

00:07:53.792 --> 00:07:58.300
[MUSIC PLAYING]

